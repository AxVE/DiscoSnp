%% BioMed_Central_Tex_Template_v1.06
%%                                      %
%  bmc_article.tex            ver: 1.06 %
%                                       %

%%IMPORTANT: do not delete the first line of this template
%%It must be present to enable the BMC Submission system to
%%recognise this template!!

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                     %%
%%  LaTeX template for BioMed Central  %%
%%     journal article submissions     %%
%%                                     %%
%%          <8 June 2012>              %%
%%                                     %%
%%                                     %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                                                 %%
%% For instructions on how to fill out this Tex template           %%
%% document please refer to Readme.html and the instructions for   %%
%% authors page on the biomed central website                      %%
%% http://www.biomedcentral.com/info/authors/                      %%
%%                                                                 %%
%% Please do not use \input{...} to include other tex files.       %%
%% Submit your LaTeX manuscript as one .tex document.              %%
%%                                                                 %%
%% All additional figures and files should be attached             %%
%% separately and not embedded in the \TeX\ document itself.       %%
%%                                                                 %%
%% BioMed Central currently use the MikTex distribution of         %%
%% TeX for Windows) of TeX and LaTeX.  This is available from      %%
%% http://www.miktex.org                                           %%
%%                                                                 %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% additional documentclass options:
%  [doublespacing]
%  [linenumbers]   - put the line numbers on margins

%%% loading packages, author definitions

%\documentclass[twocolumn]{bmcart}% uncomment this for twocolumn layout and comment line below
\documentclass{bmcart}

%%% Load packages
%\usepackage{amsthm,amsmath}
%\RequirePackage{natbib}
%\RequirePackage{hyperref}
\usepackage[utf8]{inputenc} %unicode support
%\usepackage[applemac]{inputenc} %applemac support if unicode package fails
%\usepackage[latin1]{inputenc} %UNIX support if unicode package fails


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                             %%
%%  If you wish to display your graphics for   %%
%%  your own use using includegraphic or       %%
%%  includegraphics, then comment out the      %%
%%  following two lines of code.               %%
%%  NB: These line *must* be included when     %%
%%  submitting to BMC.                         %%
%%  All figure files must be submitted as      %%
%%  separate graphics through the BMC          %%
%%  submission process, not included in the    %%
%%  submitted article.                         %%
%%                                             %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% \def\includegraphic{}
% \def\includegraphics{}



%%% Put your definitions there:
\startlocaldefs

\usepackage{xspace}
\newcommand{\disco}{{\it DiscoSnp}\xspace}
\newcommand{\discopp}{{\it DiscoSnp++}\xspace}
\newcommand{\co}{{\it cortex}\xspace}
\usepackage{xcolor}
\definecolor{my_green}{rgb}{0,0.5,0}
\usepackage{graphicx}
\usepackage{color}
\usepackage{url}
\endlocaldefs


%%% Begin ...
\begin{document}

%%% Start of article front matter
\begin{frontmatter}

\begin{fmbox}
\dochead{Technical Note}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the title of your article here     %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{{\it DiscoSnp++}: detection of all kinds of SNPs and indels from raw unassembled read set(s)}
%CL attention : all kinds of indels, ne vaudrait-il pas mieux etre plus prudent et mettre small indels ?

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the authors here                   %%
%%                                          %%
%% Specify information, if available,       %%
%% in the form:                             %%
%%   <key>={<id1>,<id2>}                    %%
%%   <key>=                                 %%
%% Comment or delete the keys which are     %%
%% not used. Repeat \author command as much %%
%% as required.                             %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\author[
   addressref={aff1},                   % id's of addresses, e.g. {aff1,aff2}
   corref={aff1},                       % id of corresponding address, if any
   % noteref={n1},                        % id's of article notes, if any
   email={pierre.peterlongo@inria.fr}   % email address
]{\inits{PP}\fnm{Pierre} \snm{Peterlongo}}
 \author[
    addressref={aff1},
    email={erwan.drezen@inria.fr}
 ]{\inits{ED}\fnm{Erwan} \snm{Drezen}}
 \author[
    addressref={aff1},
    email={claire.lemaitre@inria.fr}
 ]{\inits{ED}\fnm{Claire} \snm{Lemaitre}}
 \author[
    addressref={aff1},
    email={chloe.riou@inria.fr}
 ]{\inits{ED}\fnm{Chlo√©} \snm{Riou}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the authors' addresses here        %%
%%                                          %%
%% Repeat \address commands as much as      %%
%% required.                                %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\address[id=aff1]{%                           % unique id
  \orgname{GenScale, INRIA Rennes Bretagne-Atlantique, IRISA}, % university, etc
  \street{Campus de Beaulieu},                     %
  %\postcode{}                                % post or zip code
  \city{Rennes},                              % city
  \cny{France}                                    % country
}
% \address[id=aff2]{%
%   \orgname{Marine Ecology Department, Institute of Marine Sciences Kiel},
%   \street{D\"{u}sternbrooker Weg 20},
%   \postcode{24105}
%   \city{Kiel},
%   \cny{Germany}
% }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter short notes here                   %%
%%                                          %%
%% Short notes will be after addresses      %%
%% on first page.                           %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{artnotes}
%\note{Sample of title note}     % note to the article
% \note[id=n1]{Equal contributor} % note, connected to author
\end{artnotes}

\end{fmbox}% comment this for two column layout

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% The Abstract begins here                 %%
%%                                          %%
%% Please refer to the Instructions for     %%
%% authors on http://www.biomedcentral.com  %%
%% and include the section headings         %%
%% accordingly for your article type.       %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{abstractbox}

\begin{abstract} % abstract

Next Generation Sequencing (NGS) data provide an unprecedented access to life mechanisms. In particular, these data enable to detect polymorphisms such as SNPs and indels. 
As these polymorphisms represent a fundamental source of information in agronomy, environment or medicine,  their detection in NGS data is now a routine task. The main methods for their prediction usually need a reference genome. However, non-model organisms and highly divergent genomes such as in cancer studies are more and more investigated. 
The \disco tool has been successfully applied to predict isolated SNPs from raw read set(s) 
%(1 to $n$) 
without the need of a reference genome. 
We propose \discopp, the successor of \disco, which benefits from a new algorithm 
%software ? du point de vue algo ce n'est pas different, non ?
design that reduces time and memory consumption, detects all kinds of SNP and small indels, adds genotype information and outputs a VCF file. Results show that \discopp performs better than state-of-the-art methods in terms of both quality and computational resources. 

\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% The keywords begin here                  %%
%%                                          %%
%% Put each keyword in separate \kwd{}.     %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{keyword}
\kwd{SNP}
\kwd{Indel}
\kwd{reference-free}
\end{keyword}

% MSC classifications codes, if any
%\begin{keyword}[class=AMS]
%\kwd[Primary ]{}
%\kwd{}
%\kwd[; secondary ]{}
%\end{keyword}

\end{abstractbox}
%
%\end{fmbox}% uncomment this for twcolumn layout

\end{frontmatter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% The Main Body begins here                %%
%%                                          %%
%% Please refer to the instructions for     %%
%% authors on:                              %%
%% http://www.biomedcentral.com/info/authors%%
%% and include the section headings         %%
%% accordingly for your article type.       %%
%%                                          %%
%% See the Results and Discussion section   %%
%% for details on how to create sub-sections%%
%%                                          %%
%% use \cite{...} to cite references        %%
%%  \cite{koon} and                         %%
%%  \cite{oreg,khar,zvai,xjon,schn,pond}    %%
%%  \nocite{smith,marg,hunn,advi,koha,mouse}%%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%% start of article main body
% <put your article body there>

%%%%%%%%%%%%%%%%
%% Background %%
%%

\section*{Introduction}

Next Generation Sequencing (NGS) data provides an unprecedented access to life mechanisms. In particular, these data enable to assess genetic differences between chromosomes, individuals or species. 
Such polymorphisms represent a fundamental source of information in many aspects of biology with numerous applications in agronomy, environment or medicine. 

Within the democratization of the sequencing provided by the NGS technologies, determining genetic differences as SNPs or indels has now become a routine task.
% the last decade. 
There exist numerous software designed for predicting such polymorphisms. Mostly, these methods are based on the use of a reference genome as this is the case for GATK~\cite{gatk} or SamTools~\cite{Li2009} 
%CL pb ici dans la phrase
mapping sequenced reads or by mapping partial assemblies as for DISCOVAR~\cite{Weisenfeld2014} or FERMI~\cite{Li2012} to cite a few. Basically, they first map the NGS reads to the reference and in a second phase they scan the reference genome to analyse for each locus the differences between the reference sequence and the mapped reads. %CL : enleve la partie classification et ranking ?? are analyzed to be classified and ranked with respect to several criteria, and output. %and output ?

These methods are well accepted and extensively used. However, they present severe drawbacks. First they are extremely 
%CL trop fort extremely ?
sensitive to the mapping quality. Highly repeated regions of the reference genome are difficult to map with a high degree of confidence.  Polymorphism detected from these repeated regions may be erroneous as the quantification of mapped reads is erroneous and as the differences between occurrences of the repeats can be wrongly interpreted as polymorphism. Secondly, they suffer from the fact that they need a high quality reference genome. This evident and strong condition limits the application to reference species. 

In practice, biologists are more and more working on species for which there exists no confident reference genome. Additionally, despite major improvements in the sequencing techniques this last decade, reconstructing a perfect and complete genome from reads remains a highly complex task~\cite{assemblathon2}. In this context, there is an important need for \emph{reference-free} methods detecting SNPs and indels, directly from NGS reads, without requiring an assembled reference sequence. An alternative method consists in first assemble the reads before to map them back to the so obtained reference, as this is the case in~\cite{Willing2011}. However, such methods cumulate both the assembly and the mapping difficulties. In this manuscript, we refer to such methods as the \emph{hybrid} strategy. 

A few methods~\cite{Peterlongo2010,iqbal2012novo,Leggett2013,Nordstrom2013,Kissplice} were proposed for \emph{de-novo} detection of polymorphism.  All these methods are based on the use of the \emph{de Bruijn graph}, i.e. a directed graph where the set of vertices corresponds to the set of words of length $k$ ($k$-mers) contained in the reads, and there is an edge between two $k$-mers if they overlap on $k-1$ nucleotides. In this data structure, polymorphisms generate recognizable patterns called the \emph{bubbles}. These tools detect and analyze such bubbles in order to decipher their origin (sequencing errors, inexact repeats, real SNP or indel). 

We recently proposed \disco, a \emph{reference-free} method for detecting isolated SNPs~\cite{Uricaru2014a}. The \disco approach outperforms other \emph{reference-free} methods in terms of both computational needs and results quality. Its main features are \textbf{1}/ its extremely low memory usage (several billion reads may be analyzed with no more than 6 GB RAM memory), \textbf{2}/ its high execution speed, \textbf{3}/ its high precision and recall, \textbf{4}/ the precision of the score assigned to each predicted SNP, \textbf{5}/ the fact that it can be applied to any number of read sets (from 1 to $n$), and \textbf{6}/ the kind of SNPs it detects, called \emph{isolated}. Isolated SNPs are SNPs that are distant to the left and to the right by at least $k$ nucleotides from any other polymorphisms, with $k$ being one of the main parameters of any \emph{de novo}
%CL : vrai any ?
SNP detection tool. Isolated SNPs have the advantage to be easily amplified by PCR. However isolated SNPs do not represent all SNPs. Although isolated SNPs are usually the most common, in some cases, such as with highly polymorphic genomes and/or with numerous distinct genomes compared simultaneously, only a fraction of SNPs are isolated and so detected by \disco.


In this paper, we present \discopp that is an extension of the \disco tool. The tool was re-implemented from scratch using the GATB library~\cite{Drezen2014}. The detection of isolated SNPs remains exactly the same with \discopp, but with a much better running time. Additionally, \discopp detects new kinds of variants and it can output the predicted variants in the commonly-used VCF format.  

%CL je mettrais ces paragraphes plut√¥t dans la partie suivante, ce n'est plus vraiment de l'intro, √ßa devient technique (et raccourcirais pour pas que discoSNP prenne plus de place que ++)
The \disco tool is based on the analysis of the \emph{de Bruijn Graph} (dBG) for predicting \emph{isolated SNPs}. An \emph{isolated SNP} is a SNPs that is at least $k$ nucleotides apart from any other polymorphism, with $k$ the size of the $k$-mers used in the dBG. 

In a dBG, a \emph{bubble} denotes a path in the graph which diverges into two distinct paths before to merge back. In the dBG of one or several read sets, a specific motif witnesses the presence of isolated SNPs. This motif is a bubble whose both distinct paths are composed of exactly $k$ nodes. Figure~\ref{fig:basical_bubble}.a shows a toy example of such a bubble. 



\disco works as follows: \textbf{(1)} build the dBG of the input dataset(s);  \textbf{(2)} detect motifs witnessing the presence of isolated SNPs; \textbf{(3)} output their corresponding sequences together with the contig they belong to; \textbf{(4)} map back the reads of all read sets on the sequences of these motifs, mainly in order to recover the coverage and read quality per read sets. 

The final output is a Fasta file containing for each predicted SNP a couple of sequence distinct by a unique polymorphic nucleotide. Among other informations, the headers of the sequences provides the coverage per allele and per read set. 

A score between 0 and 1 is affected to each SNP. This score is the Phi coefficient of the table of read counts, computed as follows: $\sqrt{\frac{\chi^2}{n}}$. When two or more read sets are used, this score enables to distinguish predicted SNPs due to inexact repeats from real SNPs as inexact repeats are likely to have a similar profile in each dataset.  



\section*{Improvements in \discopp}
Several improvements are proposed in \discopp. In particular, the type of predicted variant is no longer limited to isolated SNPs. In addition, a VCF file is output, providing among others the genotype of the predictions and their mapping position on a reference genome if provided.

\subsection*{Detecting close SNPs and indels}


Conversely to isolated SNPs, \emph{close} SNPs are SNPs that are close to each other or to any source of polymorphism by less than $k$ nucleotides.
In the dBG, close SNPs generate a bubble in which the two distinct paths still contain the same number of nodes, but this number is no longer equal to $k$, but is larger than $k$.
%are composed of more than $k$ nodes. 
Figure~\ref{fig:basical_bubble}.b shows a toy example of such a bubble.  
In \discopp, we extended the initial model detection in order to detect close SNPs in addition to isolated ones. The user may limit the maximal number of close SNPs that can be detected in a bubble. %This highly limit the computation time as well as the false positive rate. 

As presented in Figure~\ref{fig:basical_bubble}.c, indels also generate bubbles in the dBG. The two paths of such bubbles are of distinct lengths. The smaller one is of size at most $k-1$ nodes. \discopp detects isolated indels in the dBG. The user limits the maximal size of the insertion. 
%CL ajouter des d√©tails sur les tailles d'indels qui peuvent √™tre d√©tect√©s :  a priori n'importe quelle taille, mais √† cause des branchements limitation... c'est imporatnt je pense d'etre honnete sur les tailles. 

\subsection*{Predicting genotypes}
For each prediction and each dataset, a genotype is provided assuming each dataset corresponds to a diploid individual. Genotypes are inferred independently for each individual, based on the read coverage of each allele of the bubble. To do so, the likelihoods of the three possible genotypes (homozygous 0/0 or 1/1 or heterozygous, 0/1) are computed based on a simple binomial model as described in the Nielsen 2011 review~\cite{Nielsen2011}, see Additional File 1 for likelihood formula and details). These computations rely on only one parameter, namely the \emph{error probability}, that is the probability that a read maps to a given allele erroneously,
%assuming it is fixed and indepentent between all observations.
 it was fixed to 0.01, referring to classical sequencing error rates. Finally, the genotype showing the largest likelihood is chosen and all three likelihoods are also output (-log10 transformed) as additional information. Notably, only the probability of observing the data (ie. the read counts for each allele) given the genotype is computed, no prior is used so as to compute the posterior probabilities of each genotype given the data. Users may deactivate genotyping, for instance when the input datasets are not coming from diploid individuals.

\subsection*{Providing a VCF file}
The original \disco output is a fasta file. It contains a couple of sequences for each predicted polymorphism. Headers of these sequences contain the read count and average read quality per allele, and the predicted genotype, and these for each input read set. 
%CL : attention pas 1 genotype par variant
The read coverages for all datasets are used to provide additionally a trustful ranking of the predictions based on their discrimination between the datasets 
%CL: pas sur que ce soit bien dit...
(see for instance the results presented Figure~\ref{fig:roc_human}).

In \discopp, in addition to the original fasta format, a VCF file is output. This file provides all pieces of information contained in the original fasta headers.

Importantly, if a reference genome is provided, \discopp predictions are mapped to it. In this case, for the variants successfully mapped to the reference, the VCF file contains their genomic position, the reference and the alternative allele unless none of the mapped sequences correspond to the reference genome, and additional mapping information (see Additional File 1 for details about the mapping process and details about the VCF content). Notably, each polymorphism is classified according to the uniqueness of its mapping and this enables to further identify (and possibly filter out) putative false positives due to repeats in the genome.
%CL : ajouter qqchose sur unique ou multiple mapping -> permet de discriminer encore plus les FP
If no reference is provided, the genomic position fields are replaced by dummy value '.'.

\subsection*{Other improvements}
The code was re-implemented from scratch using the GATB library~\cite{Drezen2014}. This provides a much easier way to handle the graph file, this improves the running time, with clearer progress messages. 
%CL ajout sur GATB
In particular, the graph file format is common to other GATB tools, and the graph can be computed once for a given dataset and later be used with several other tools such as de novo assembly (minia \cite{}) and inversion discovery (TakeABreak\cite{}). 
%bientot rajouter MindTheGap, BGREAT ?
Additionally, \discopp handles pair of reads during the counting phase. Simply, each pair of read files is considered as a unique read set while computing coverages, qualities, ranks and genotypes. 

%CL il faudra rajouter ici le seuil automatique ?

\section*{Results}
We propose results both on synthetic and on real datasets. Synthetic datasets offer a way to exactly compute the precision and the recall of \discopp and of state-of-the-art methods. Real datasets enable to assess the %TODO

\subsection*{Results on synthetic datasets}
We first propose a bench of results based on synthetic datasets. As presented in the Additional File 1, these datasets are derived from real genomes, either from \emph{Escherichia coli} or from the human chromosome 1. 

In these experiments, we generated the set of SNPs and indels. 
%CL je pense que c'est important de d√©tailler quelles tailles d'indels
Thus, we dispose of the exact and exhaustive list of variants to be found, and we are able to compute the precision and the recall of the predictions (see Additional File 1 for precision and recall computation details). We tested \discopp, \co~\cite{iqbal2012novo} and an hybrid method composed of SOAPdenovo2~\cite{luo2012soapdenovo2} for generating the assembly, Bowtie2~\cite{langmead2012fast} for mapping the reads on the assembly, and GATK~\cite{gatk} for calling variants. Presented results were obtained using \emph{UnifiedGenotyper} option of GATK. As presented in the Additional File 1, when following the GATK guidelines (including read realignment and using the \emph{HaplotypeCaller} option), the result quality is similar but at the expense of a much longer execution time (almost 3 times longer, from approximately 19h to 54h for the human chromosome 1 experiment). 

\subsubsection*{Two and more bacterial read sets}
We performed an experiment on a variable number of read sets. Each read set corresponds to a simulation of the sequencing of an \emph{Escherichia coli} individual. As presented in the Additional File 1, we simulated SNPs and indels such that the distributions of shared polymorphism between subsets of individuals are realistic. 

Precision and recall results, presented in Figure~\ref{fig:ncoli}, allow to draw conclusions while calling SNPs from several haploid individuals. 
%CL la phrase ci-dessus ne dit pas grand chose, preciser quelles conclusions ?
On these data, for calling both SNPs and indels, the \co precision is perfect or nearly perfect, whereas the recall strongly decreases when the number of read sets increases, until reaching less than 9\% for 30 individuals. 

For SNP calling, the hybrid strategy provides better results than \discopp: its recall is slightly better, and its precision remains more or less constant whereas the \discopp precision linearly decreases with the number of read sets. 
%CL je ne me rappelle plus comment on explique que c'est la precision qui decroit (j'aurais plutot dit le recall a priori, on est en -b 2)?

However, concerning indel calling, the hybrid strategy shows bad performances, that may be explained by the difficulty of mapping reads with indels. Conversely, \discopp presents high quality results both in terms of precision and in terms of recall. 


In short and in terms of results quality only, for calling all SNPs from a large number of read sets from a rather simple haploid genome, it is preferable to use an hybrid approach. However, we recall that for calling isolated SNPs only, \disco and the hybrid strategy lead to similar results (see~\cite{Uricaru2014a}). Note that the \disco results may be mimicked with \discopp by forbidding indels and close SNPs predictions. As for indel calls, \discopp performs better than the other methods.

Importantly, as shown in Figure~\ref{fig:ncoliperf}, \discopp runs much faster that other methods and uses much less RAM memory. Moreover, one may also insist on the fact that \discopp is extremely simple to use. Table~\ref{tab:2colicmpxt}, showing the number of operations to perform for each method, witnesses unequivocally
%clearly 
this simplicity.

\subsubsection*{Two human datasets}
\label{ssec:twohumans}
For testing \discopp on a diploid and more complex genome, we propose an experiment based on the human chromosome 1, assembly GRCh37. Using variants from the 1000 genomes project, we simulated two individuals, generating 25,928 indels and 288,069 SNPs. 
%CL idem indel size
The data simulation protocol is presented in the Additional File 1. 

Results while 
%CL je ne suis pas trop sure du while ici
considering all predictions are presented Table~\ref{tab:humanresults}. 
The main conclusion is that, except from the hybrid approach that predicts few indels (40.97\%) with a high precision (96.15\%), other results do not show  notable difference, even if one may notice that precision is globally larger for indels, whereas the recall is higher for SNPs. 

Results presented Figure~\ref{fig:roc_human} provide additional pieces of information for the hybrid and the \discopp approaches. They show precision/recall values with respect to the ranking of the predictions (\co results are not ranked in this framework). Results show that the hybrid approach predictions are badly ranked: it appears that predictions showing the best scores are mainly false positives. Additionally, results show that the \discopp ranking is extremely efficient for separating false positives from true positives. Most of the predictions ranked with a score $>0.2$ are true positives (97.78\%  of the SNPs and 98.97\% of the indels). 

From these experiment on a complex eukaryotic species, one may conclude that \discopp overall results quality is similar to the ones from other methods. However, it is the only tool with a reliable ranking of the results, enabling to select more than 50\% of the predictions with a nearly perfect precision.

As previously mentioned, \discopp provides for each predicted polymorphism, genotype estimations for all individuals. On this dataset, over the 245,690 true positive variants, 240,935 predicted genotypes (98.06\%) were correct. 
%CL : on ne devrait pas avoir 2x plus de genotypes, car 2 individus ? ou bien correct veut dire correct pour les 2 individus ?
%CL :  ne pourrait-on pas rajouter les infos de mapping : ie. le % de bons g√©notypes sur les variants mapp√©s uniquement -> les 2% mauvais seraient dus √† des r√©p√©titions (devraient √™tre plus souvent hetero que homo ?) 

As shown in Figure~\ref{fig:perf_human}, \discopp runs much faster that other methods (3.6x and 17.5x times faster than \co and the hybrid approach respectively) and uses much less RAM memory (36.2x and 22.9x times less memory than \co and the hybrid approach respectively). 

HERE des resultats de mapping sur ref ?? avec genome initial et genome divergent ?



\subsection*{Results on real datasets}
We used a set of biologically validated SNPs predicted from an artificial evolution study on \emph{Saccharomyces cerevisiae}~\cite{Kvitek2013}. 
In this study, three glucose-limited, chemostat-evolved populations of the haploid yeast strain S288c, named
E1, E2 and E3, were sequenced every $\approx70$ generations, giving eight samples per population. Using a reference-based mapping approach, 110 mutations were discovered, among which only 33 have a minor allele frequency (MAF) $>10\%$ and 32 were confirmed by Sanger sequencing.  \discopp was run independently on populations E1, E2 and E3. For each population, \discopp was applied on the eight read sets corresponding to the eight time points, with the default parameters and c = 11. 

This dataset enables to evaluate \discopp recall for SNPs only on real read datasets. Among the 32 experimentally validated SNPs, 29 were predicted by \discopp, leading to an estimated recall of 90.7\%. Using parameter -b 2 leads to the detection of the unpredicted SNPs. The fact that these SNPs were not detected with the default (-b 1) parameter means that its bubble is symmetrically branching (see~\cite{Uricaru2014a} for an explanation of the branching filtering strategies). This suggests that these SNPs are located in complex regions of the genome. %CL on devrait le v√©rifier avec les r√©sultats de mapping -> mapp√©s multiplement ? 

%CL est-ce qu'il y a avait des SNPs proches dans le lot de valid√©s : un mot dessus ? sinon, ca risque de ressembler beaucoup au papier NAR cette section...

Note that in the~\cite{Kvitek2013} study, no SNP with a MAF $<10\%$ were validated and no indel were validated, so we could not assess the precision of these types of \discopp predictions on this dataset.


% \section*{Conclusion}
% TODO
\section*{Availability and requirements}
\begin{itemize}
	\item \textbf{Project name:} \discopp
	\item \textbf{Operating systems}: Linux and osx;
	\item \textbf{Programming language}: C++ (main algorithms), bash and python;
	\item \textbf{Other requirement}: BWA~\cite{bwa} if users require to map predictions to a reference genome when generating a VCF ouput;
	\item \textbf{License}: GNU AFFERO GENERAL PUBLIC LICENSE \url{gnu.org/licenses/agpl.html}
	\item \textbf{Any restrictions to use by non-academics}: license needed
\end{itemize}


\section*{Availability of supporting data}
[TODO if suitable for review]

The data sets supporting the results of this article are available in the [repository name] repository, [unique persistent identifier and hyperlink to dataset(s) in http:// format].


\section*{Abbreviations}
NGS: Next Generation Sequencing; SNP: Single Nucleotide Polymorphism; indel: insertion or deletion; PCR: Polymerase Chain Reaction; dBG: de Bruijn Graph; VCF: Variant Call Format; SAM: Sequence Alignment/Map; BAM: Binary Alignment/Map



% section section_name (end)



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Backmatter begins here                   %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{backmatter}

\section*{Competing interests}
  The authors declare that they have no competing interests.

\section*{Author's contributions}
ED implemented the GATB library and re-coded \disco using this library, including parallelization and optimizations. PP designed and implemented the close SNPs and deletion detection algorithms. CL designed and implemented the genotyping algorithms. CR designed and implemented the VCF generation algorithms.  PP conceived and coordinated of the study, he wrote the manuscript draft. All authors participated in the writing, read and approved the final manuscript. 

\section*{Acknowledgements}
 We thank the \emph{GenOuest} (\url{genouest.org}) cluster team, who allowed us to perform all the tests. This work was supported by the French ANR-12-BS02-0008 \emph{Colib'read} project and by the ANR-12-EMMA-0019-01 \textbf{GATB} project.
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                  The Bibliography                       %%
%%                                                         %%
%%  Bmc_mathpys.bst  will be used to                       %%
%%  create a .BBL file for submission.                     %%
%%  After submission of the .TEX file,                     %%
%%  you will be prompted to submit your .BBL file.         %%
%%                                                         %%
%%                                                         %%
%%  Note that the displayed Bibliography will not          %%
%%  necessarily be rendered by Latex exactly as specified  %%
%%  in the online Instructions for Authors.                %%
%%                                                         %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% if your bibliography is in bibtex format, use those commands:
\bibliographystyle{bmc-mathphys} % Style BST file
\bibliography{discoSnppp_giga_science}      % Bibliography file (usually '*.bib' )

% or include bibliography directly:
% \begin{thebibliography}
% \bibitem{b1}
% \end{thebibliography}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                               %%
%% Figures                       %%
%%                               %%
%% NB: this is for captions and  %%
%% Titles. All graphics must be  %%
%% submitted separately and NOT  %%
%% included in the Tex document  %%
%%                               %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%
%% Do not use \listoffigures as most will included as separate files

\section*{Figures}

\begin{figure}[h!]  
\begin{minipage}[c]{0.05\textwidth}
\textbf{(a)}
\end{minipage}
\begin{minipage}[c]{0.90\textwidth}
\includegraphics[height=1.5cm]{figures/bubble_snp.png}
\end{minipage}\\

\begin{minipage}[c]{0.05\textwidth}
\textbf{(b)}
\end{minipage}
\begin{minipage}[c]{0.9\textwidth}
\includegraphics[height=1.5cm]{figures/bubble_close_snp.png}
\end{minipage}\\


\begin{minipage}[c]{0.05\textwidth}
\textbf{(c)}
\end{minipage}
\begin{minipage}[c]{0.9\textwidth}
\includegraphics[height=1.5cm]{figures/bubble_indel.png}
\end{minipage}\\

	
\caption{\csentence{Examples of dBG ($k=4$) bubbles due to SNP, close SNPs and indel.} \textbf{(a)} Bubble generated by an isolated SNP. Detected both by \disco and  \discopp. Prediction would be ACTG\textcolor{red}{A}CCTG and ACTG\textcolor{red}{T}CCTG. \textbf{(b)} Bubble generated by two close SNPs. Detected only by \discopp. Prediction would be ACTG\textcolor{red}{A}C\textcolor{red}{C}TAAT and ACTG\textcolor{red}{T}C\textcolor{red}{G}TAAT. \textbf{(c)} Bubble generated by an insertion. Detected only by \discopp. Prediction would be \textcolor{red}{ACTG}\textcolor{my_green}{ACCT} and \textcolor{red}{ACTG}TT\textcolor{my_green}{ACCT}. }
\label{fig:basical_bubble}
\end{figure}

\begin{figure}[h!]  
	\includegraphics[width=\linewidth]{../tests_n_coli_NAR/n_coli.png}
\caption{\csentence{\discopp, \co and hybrid strategy (SOAPdenovo2+GATK) results, depending on the number of input haploid individuals.} SOAPdenovo2 and GATK were launched with default parameters. For \discopp and \co, $k$-mers having three or fewer occurrences in all datasets were removed. Precision and recall: filled symbols represent the precision and empty symbols represent the recall. \textbf{Left:} results on SNPs predictions. \textbf{Right:} results on indels predictions. \label{fig:ncoli}}
\end{figure}


\begin{figure}[h!]  
	\includegraphics[width=\linewidth]{../tests_n_coli_NAR/perf_bact_article.png}
\caption{\csentence{Comparative memory and time performances, depending on the number of input haploid individuals.}\label{fig:ncoliperf}}
\end{figure}

\begin{figure}[h!]  
	\includegraphics[width=\linewidth]{../tests_human/results/roc_human.png}
\caption{\csentence{Comparative results of \discopp, \co,  and the hybrid SOAPdenovo2 + Bowtie2 + GATK approaches on the two diploid human chromosome 1 dataset.} Precision versus recall curves are obtained by ranking the predicted SNPs and indels. Each data point is obtained at a given rank threshold, where precision and recall values are computed for all SNPs with better ranks than this threshold. The dashed tail of the two \discopp curves denotes the predictions ranked with a threshold bellow $0.2$.
In this framework \co does not rank its predictions, its results are thus represented by a single point. \label{fig:roc_human}}
\end{figure}

\begin{figure}[h!]  
	\includegraphics[width=\linewidth]{../tests_human/results/perf_human_article.png}
\caption{\csentence{Comparative memory and time performances for comparing the two human datasets}\label{fig:perf_human}}
\end{figure}


%
% \begin{figure}[h!]
% \includegraphics[width=\linewidth]{../tests_n_coli_NAR/expes/res_b0_D_10_P_4_c_4_d_1.png}
% \caption{\csentence{AFAC Precision Recall of \discopp on a various number of E. Coli read sets.}
%       $b=0, D=10, P=4, c=4, d=1$.}
% \end{figure}
%
%
%
% \begin{figure}[h!]
% \includegraphics[width=\linewidth]{../tests_n_coli_NAR/expes/res_b1_D_10_P_4_c_4_d_1.png}
% \caption{\csentence{AFAC Precision Recall of \discopp on a various number of E. Coli read sets.}
%       $b=1, D=10, P=4, c=4, d=1$.}
% \end{figure}
%
%
% \begin{figure}[h!]
% \includegraphics[width=\linewidth]{../tests_n_coli_NAR/expes/res_b1_D_10_P_1_c_4_d_1.png}
% \caption{\csentence{AFAC Precision Recall of \discopp on a various number of E. Coli read sets.}
%       $b=1, D=10, P=1, c=4, d=1$.}
% \end{figure}
%
% \begin{figure}[h!]
% \includegraphics[width=\linewidth]{../tests_n_coli_NAR/expes/res_b2_D_10_P_4_c_4_d_1.png}
% \caption{\csentence{AFAC Precision Recall of \discopp on a various number of E. Coli read sets.}
%       $b=2, D=10, P=4, c=4, d=1$.}
% \end{figure}
%
%
% \begin{figure}[h!]
% \includegraphics[width=\linewidth]{../tests_n_coli_NAR/res_cortex_sabre/results.png}
% \caption{\csentence{AFAC Precision Recall of Cortex on a various number of E. Coli read sets.}
%       $k=31$.}
% \end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                               %%
%% Tables                        %%
%%                               %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Use of \listoftables is discouraged.
%%
\section*{Tables}
\begin{table}[h!]
	\caption{Command line complexity in term of required number of command (including file formatting when necessary) while calling variants from 2 and 30 haploid genomes. See Additional File 1 for details.\label{tab:2colicmpxt}}
	\begin{tabular}{r|c|c}
		 & \begin{tabular}{c}Number of commands\\for two genomes\end{tabular} & \begin{tabular}{c}Number of commands\\for 30 genomes\end{tabular}\\\hline
		 Hybrid & 19  & 187\\
		 \co & 8 (+2 compilations) & 35 (+30 compilations) \\
		 \discopp & 2 & 2
	\end{tabular}
	\end{table}
	
	

\begin{table}[h!]
	\caption{Human chromosome 1 results.  \label{tab:humanresults} }
	\begin{tabular}{r|cc|cc}
		 & \multicolumn{2}{c|}{SNP} & \multicolumn{2}{c}{indels}\\
		 & Precision (\%) & Recall (\%) & Precision (\%) & Recall (\%) \\\hline
		 Hybrid & 71.60 & 78.59 & \textbf{96.15} & 40.97\\
		 \co& {73.19} & 67.34 & 86.65 & 63.25 \\
		 \discopp& 71.71 & \textbf{78.88} & 75.86 & \textbf{71.15} \\\hline
		 \discopp (rank $>$ 2)& 97.78 & 64.39 & 98.97 & 57.78 
	\end{tabular}
	\end{table}
% \begin{table}[h!]
% \caption{Sample table title. This is where the description of the table should go.}
%       \begin{tabular}{cccc}
%         \hline
%            & B1  &B2   & B3\\ \hline
%         A1 & 0.1 & 0.2 & 0.3\\
%         A2 & ... & ..  & .\\
%         A3 & ..  & .   & .\\ \hline
%       \end{tabular}
% \end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                               %%
%% Additional Files              %%
%%                               %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section*{Additional Files}
  \subsection*{Additional file 1 --- Sample additional file title}
    Additional file descriptions text (including details of how to
    view the file, if it is in a non-standard format or the file extension).  This might
    refer to a multi-page table or a figure.
  %
  % \subsection*{Additional file 2 --- Sample additional file title}
  %   Additional file descriptions text.


\end{backmatter}
\end{document}
